{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "title": "CEDAR Template Validation Schema",
    "description": "A JSON Schema document that describes the CEDAR template schema and can be used to validate it",
    "definitions": {
        "coreJSONSchemaFields": {
            "type": "object",
            "description": "A schema that describes core JSON Schema fields",
            "properties": {
                "$schema": {
                    "description": "Schema describing the JSON Schema '$schema' field in a template, element, and field",
                    "type": "string",
                    "format": "uri",
                    "enum": [ "http://json-schema.org/draft-04/schema#" ]
                },
                "type": {
                    "description": "Schema describing the JSON Schema 'type' field in a template, element, and field",
                    "type": "string",
                    "enum": [ "object" ]
                },
                "title": {
                    "description": "Schema describing the JSON Schema 'title' field in a template, element, and field",
                    "type": "string",
                    "minLength": 1
                },
                "description": {
                    "description": "Schema describing the JSON Schema 'description' field in a template, element, and field",
                    "type": "string",
                    "minLength": 1
                },
                "additionalProperties": {
                    "description": "Schema describing the JSON Schema 'additionalProperties' field in a template, element, and field",
                    "type": "boolean",
                    "enum": [ false ]
                }
            },
            "required": [
                "$schema",
                "type",
                "title",
                "description",
                "properties",
                "additionalProperties"
            ]
        },
        "coreJSONSchemaTemplateFields": {
            "type": "object",
            "description": "A schema that describes JSON Schema template fields",
            "allOf": [
                { "$ref": "#/definitions/coreJSONSchemaFields" },
                { "properties":
                  {
                      "required": {
                          "description": "Schema describing the 'required' field in a template",
                          "type": "array",
                          "minItems": 2,
                          "maxItems": 2,
                          "items": [
                              {
                                  "type": "string",
                                  "enum": [ "@id" ]
                              },
                              {
                                  "type": "string",
                                  "enum": [ "_templateId" ]
                              }
                          ],
                          "uniqueItems": true
                      }
                  },
                  "required": [
                      "required"
                  ]
                }
            ]
        },
        "coreJSONSchemaTemplateElementFields": {
            "type": "object",
            "description": "A schema that describes JSON Schema template element fields",
            "allOf": [
                { "$ref": "#/definitions/coreJSONSchemaFields" },
                { "properties":
                  {
                      "required": {
                          "description": "Schema describing the contents of the 'required' field in a template element",
                          "type": "array",
                          "minItems": 1,
                          "items": [
                              {
                                  "type": "string",
                                  "enum": [ "@id" ]
                              }
                          ],
                          "uniqueItems": true
                      }
                  },
                  "required": [
                      "required"
                  ]
                }
            ]
        },
        "coreJSONSchemaTemplateFieldFields": {
            "type": "object",
            "title": "CEDAR Core JSON Schema Template Field fields schema",
            "description": "A schema that describes JSON Schema template field fields",
            "allOf": [
                { "$ref": "#/definitions/coreJSONSchemaFields" },
                { "properties":
                  {
                      "required": {
                          "description": "Schema describing the contents of the 'required' field in a template field",
                          "type": "array",
                          "minItems": 1,
                          "items": [
                              {
                                  "type": "string",
                                  "enum": [ "_value" ]
                              }
                          ],
                          "uniqueItems": true
                      }
                  },
                  "required": [
                      "required"
                  ]
                }
            ]
        },
        "provenanceFields": {
            "type": "object",
            "description": "A schema that describes CEDAR provenance fields",
            "properties": {
                "pav:createdOn": {
                    "type": "string",
                    "format": "date-time"
                },
                "pav:createdBy": {
                    "type": "string",
                    "format": "uri"
                },
                "pav:lastUpdatedOn": {
                    "type": "string",
                    "format": "date-time"
                },
                "cedar:lastUpdatedBy": {
                    "type": "string",
                    "format": "uri"
                }
            }
        },
        "templateUIField": {
            "type": "object",
            "description": "A schema that describes a '_ui' field in a template",
            "properties": {
                "_ui": { "$ref": "#/definitions/templateUIFieldSchema" }
            },
            "required": [ "_ui" ]
        },
        "templateUIFieldSchema": {
            "type": "object",
            "description": "A schema that describes a '_ui' field value in a template",
            "properties": {
                "title": { "type": "string", "minLength": 1 },
                "description": { "type": "string" },
                "order": {
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string"
                    },
                    "uniqueItems": true
                }
            },
            "required": [ "title", "description", "order" ]
        },
        "templateElementUIField": {
            "type": "object",
            "description": "A schema that describes a '_ui' field in a template element",
            "properties": {
                "_ui": { "$ref": "#/definitions/templateElementUIFieldSchema" }
            },
            "required": [ "_ui" ]
        },
        "templateElementUIFieldSchema": {
            "type": "object",
            "description": "A schema that describes a '_ui' field in a template element",
            "properties": {
                "title": { "type": "string", "minLength": 1 },
                "description": { "type": "string" },
                "order": {
                    "description": "Schema describing the contents of the 'order' field in a template element '_ui' field",
                    "type": "array",
                    "minItems": 1,
                    "items": {
                        "type": "string"
                    },
                    "uniqueItems": true
                }
            },
            "required": [ "title", "description", "order" ]
        },
        "templateFieldUIField": {
            "type": "object",
            "description": "A schema that describes a '_ui' field in a template field",
            "properties": {
                "_ui": { "$ref": "#/definitions/templateFieldUIFieldSchema" }
            },
            "required": [ "_ui" ]
        },
        "templateFieldUIFieldSchema": {
            "type": "object",
            "description": "A schema that describes a _ui field in a template field value",
            "properties": {
                "title": { "type": "string", "minLength": 1 },
                "description": { "type": "string" },
                "inputType": {
                    "description": "Schema describing the contents of the 'inputType' field in a template '_ui' field",
                    "type": "string", "enum": [ "textfield", "textarea", "radio", "checkbox", "date", "email", "list", "numeric", "phone-number", "section-break", "richtext", "image", "youtube" ]
                }
            },
            "required": [ "description", "title", "inputType" ]
        },
        "valueConstraintsField": {
            "type": "object",
            "description": "A schema that describes a '_valueConstraints' field in a template field",
            "properties": {
                "_valueConstraints": { "$ref": "#/definitions/valueConstraintsFieldSchema" }
            },
            "required": [ "_valueConstraints" ]
        },
        "valueConstraintsFieldSchema": {
            "type": "object",
            "description": "A schema that describes a '_valueConstraints' field in a template field",
            "properties": {
                "ontologies": { "$ref": "#/definitions/valueConstraintsOntologiesFieldSchema" },
                "valueSets": {  "$ref": "#/definitions/valueConstraintsValueSetsFieldSchema" },
                "classes": {  "$ref": "#/definitions/valueConstraintsClassesFieldSchema" },
                "branches": {  "$ref": "#/definitions/valueConstraintsBranchesFieldSchema" },
                "requiredValue": { "type": "boolean" },
                "multipleChoice": { "type": "boolean" }
            },
            "required": [ "requiredValue" ]
        },
        "valueConstraintsOntologiesFieldSchema": {
            "description": "TODO Schema that describes the contents of the 'ontologies' field value in a '_valueConstraints' field",
            "type": "array",
        },
        "valueConstraintsValueSetsFieldSchema": {
            "description": "TODO Schema that describes the contents of the 'valueSets' field value in a '_valueConstraints' field",
            "type": "array",
        },
        "valueConstraintsClassesFieldSchema": {
            "description": "TODO Schema that describes the contents of the 'classes' field value in a '_valueConstraints' field",
            "type": "array",
        },
        "valueConstraintsBranchesFieldSchema": {
            "description": "TODO Schema that describes the contents of the 'branches' field value in a '_valueConstraints' field",
            "type": "array",
        },
        "templateJSONLDContextField" : {
            "type": "object",
            "description": "A schema that describes a JSON-LD '@context' field in a template",
            "properties": {
                "@context": { "$ref": "#/definitions/templateJSONLDContextFieldSchema" }
            },
            "required": [ "@context" ]
        },
        "templateJSONLDContextFieldSchema": {
            "description": "Schema describing the contents of the '@context' field in a template",
            "type": "object",
            "properties": {
                "pav": { "type": "string", "format": "uri", "enum": [ "http://purl.org/pav/" ] },
                "cedar": { "type": "string", "format": "uri", "enum": [ "https://schema.metadatacenter.org/core/" ] }
            },
            "required": [ "pav", "cedar" ],
            "additionalProperties": false
        },
        "templateElementJSONLDContextField" : {
            "type": "object",
            "description": "A schema that describes a JSON-LD '@context' field in a template element",
            "properties": {
                "@context": { "$ref": "#/definitions/templateElementJSONLDContextFieldSchema" }
            },
            "required": [ "@context" ]
        },
        "templateElementJSONLDContextFieldSchema": {
            "description": "Schema describing the contents of the '@context' field in a template element",
            "type": "object",
            "properties": {
                "pav": { "type": "string", "format": "uri", "enum": [ "http://purl.org/pav/" ] },
                "cedar": { "type": "string", "format": "uri", "enum": [ "https://schema.metadatacenter.org/core/" ] }
            },
            "patternProperties": {
                "^(?!pav)(?!cedar).*$": { "type": "string", "format": "uri" }
            },
            "required": [ "pav", "cedar" ],
            "additionalProperties": false
        },
        "templateFieldJSONLDContextField" : {
            "type": "object",
            "description": "A schema that describes a JSON-LD '@context' field in a template field",
            "properties": {
                "@context": { "$ref": "#/definitions/templateFieldJSONLDContextFieldSchema" }
            },
            "required": [ "@context" ]
        },
        "templateFieldJSONLDContextFieldSchema": {
            "description": "Schema describing the contents of the '@context' field in a template field",
            "type": "object",
            "properties": {
                "pav": { "type": "string", "format": "uri", "enum": [ "http://purl.org/pav/" ] },
                "cedar": { "type": "string", "format": "uri", "enum": [ "https://schema.metadatacenter.org/core/" ] }
            },
            "patternProperties": {
                "^(?!pav)(?!cedar).*$": { "type": "string", "format": "uri" }
            },
            "required": [ "pav", "cedar" ],
            "additionalProperties": false
        },
        "jsonLDTypeField" : {
            "type": "object",
            "description": "A schema that describes a JSON-LD '@type' field",
            "properties": {
                "@type": {
                    "type": "string", "format": "uri"
                }
            },
            "required": [ "@type" ]
        },
        "jsonLDIDField" : {
            "type": "object",
            "description": "A schema that describes a JSON-LD '@id' field",
            "properties": {
                "@id": {
                    "type": "string", "format": "uri"
                }
            },
            "required": [ "@id" ]
        },
        "templateJSONLDTypeField" : {
            "type": "object",
            "description": "A schema that describes a template's JSON-LD '@type' field",
            "properties": {
                "@type": {
                    "description": "Schema for the @type field in a template",
                    "type": "string",
                    "format": "uri",
                    "enum": [ "https://schema.metadatacenter.org/core/Template" ]
                }
            },
            "required": [ "@type" ]
        },
        "templateElementJSONLDTypeField" : {
            "type": "object",
            "description": "A schema that describes a template element's JSON-LD '@type' field",
            "properties": {
                "@type": {
                    "description": "Schema for the @type field in a template element",
                    "type": "string",
                    "format": "uri",
                    "enum": [ "https://schema.metadatacenter.org/core/TemplateElement" ]
                }
            },
            "required": [ "@type" ]
        },
        "templateFieldJSONLDTypeField" : {
            "type": "object",
            "description": "A schema that describes a template field's JSON-LD '@type' field",
            "properties": {
                "@type": {
                    "description": "Schema for the @type field in a template field",
                    "type": "string",
                    "format": "uri",
                    "enum": [ "https://schema.metadatacenter.org/core/TemplateField" ]
                }
            },
            "required": [ "@type" ]
        },
        "templatePropertiesField": {
            "properties":
            {             
                "properties": { "$ref": "#/definitions/templatePropertiesFieldSchema" }
            },
            "required": [ ]
        },
        "templatePropertiesFieldSchema": {
            "description": "Schema for a 'properties' field value in a template",
            "type": "object",
            "properties":
            {
                "@context": { "$ref": "#/definitions/templatePropertiesContextFieldSchema" },
                "@type": { "$ref": "#/definitions/templatePropertiesTypeFieldSchema" },
                "@id": { "$ref": "#/definitions/templatePropertiesIDFieldSchema" },
                "pav:createdOn": { "$ref": "#/definitions/templatePropertiesPAVCreatedOnFieldSchema" },
                "pav:createdBy": { "$ref": "#/definitions/templatePropertiesPAVCreatedByFieldSchema" },
                "pav:lastUpdatedOn:": { "$ref": "#/definitions/templatePropertiesPAVLastUpdatedOnFieldSchema" },
                "cedar:lastUpdatedBy": { "$ref": "#/definitions/templatePropertiesCEDARLastUpdatedByFieldSchema" },
                "_templateID": { "$ref": "#/definitions/templatePropertiesTemplateIDFieldSchema" }
            },
            "patternProperties": {
                "^(?!@context)(?!@id)(?!@type)(?!_templateId).*$": { "$ref": "#/definitions/templateFieldOrElement" }
            },
            "required": [ "@context", "@type", "@id", "_templateId" ]
        },
        "templatePropertiesContextFieldSchema": {
            "description": "TODO: Schema for the contents of a '@context' field in a 'properties' field in a template",
            "type": "object"
        },
        "templatePropertiesTypeFieldSchema": {
            "description": "Schema for the contents of a '@type' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "oneOf": {
                    "type": "array",
                    "items": [
                        { "$ref": "#/definitions/uriOrArrayOfURIsFieldSchema" }
                    ]
                }
            },
            "required": [ "oneOf" ]
        },
        "uriOrArrayOfURIsFieldSchema": {
            "oneOf": [
                { "$ref": "#/definitions/uriFieldSchema" },
                { "$ref": "#/definitions/arrayOfURIsFieldSchema" }
            ]
        },
        "uriFieldSchema": {
            "description": "Schema for URI field value",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]            
        },
        "arrayOfURIsFieldSchema": {
            "description": "TODO Schema for an array of URIs field value",
            "type": "array",
            "minItems": 1
        },
        "dateTimeFieldSchema": {
            "description": "Schema for a date-time field value",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "date-time" ] }
            },
            "required": [ "type", "format" ]            
        },
        "templatePropertiesIDFieldSchema": {
            "description": "Schema for the contents of a '@id' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]            
        },
        "templatePropertiesTemplateIDFieldSchema": {
            "description": "Schema for the contents of a '_templateID' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]
        },
        "templatePropertiesPAVCreatedOnFieldSchema": {
            "description": "Schema for the contents of a 'pav:createdOn' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "date-time" ] }
            },
            "required": [ "type", "format" ]
        },
        "templatePropertiesPAVCreatedByFieldSchema": {
            "description": "Schema for the contents of a 'pav:createdBy' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]
        },
        "templatePropertiesPAVLastUpdatedOnFieldSchema": {
            "description": "Schema for the contents of a 'pav:lastUpdatedOn' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "date-time" ] }
            },
            "required": [ "type", "format" ]
        },
        "templatePropertiesCEDARLastUpdatedByFieldSchema": {
            "description": "Schema for the contents of a 'cedar:lastUpdatedBy' field in a 'properties' field in a template",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]
        },
        "templateElementPropertiesField": {
            "properties":
            {             
                "properties": { "$ref": "#/definitions/templateElementPropertiesFieldSchema" }
            },
            "required": [ ]
        },
        "templateElementPropertiesFieldSchema": {
            "description": "Schema for a 'properties' field value in a template element",
            "type": "object",
            "properties":
            {
                "@context": { "$ref": "#/definitions/templateElementPropertiesContextFieldSchema" },
                "@type": { "$ref": "#/definitions/templateElementPropertiesTypeFieldSchema" },
                "@id": { "$ref": "#/definitions/templateElementPropertiesIDFieldSchema" },
                "_tmp": {
                    "description": "TEMPORARY: Schema for a '_tmp' field. THIS FIELD SHOULD NOT BE THERE!",
                    "type": "object"
                }
            },
            "patternProperties": {
                "^(?!@context)(?!@id)(?!@type)(?!_tmp).*$": { "$ref": "#/definitions/templateFieldOrElement" }
            },
            "required": [ "@context", "@type", "@id" ]
        },
        "templateElementPropertiesContextFieldSchema": {
            "description": "TODO: Schema for the contents of a '@context' field in a 'properties' field in a template element",
            "type": "object"
        },
        "templateElementPropertiesTypeFieldSchema": {
            "description": "TODO: Schema for the contents of a '@type' field in a 'properties' field in a template element",
            "type": "object"
        },
        "templateElementPropertiesIDFieldSchema": {
            "description": "Schema for the contents of a '@id' field in a 'properties' field in a template element",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]            
        },
        "templateFieldPropertiesField": {
            "properties":
            {             
                "properties": { "$ref": "#/definitions/templateFieldPropertiesFieldSchema" }
            },
            "required": [ ]
        },
        "templateFieldPropertiesFieldSchema": {
            "description": "Schema for a 'properties' field value in a template field",
            "type": "object",
            "properties":
            {
                "@type": { "$ref": "#/definitions/templateFieldPropertiesTypeFieldSchema" },
                "@id": { "$ref": "#/definitions/templateFieldPropertiesIDFieldSchema" },
                "_value": {
                    "description": "TODO: Schema for the contents of a '_value' field in a 'properties' field in a template field. WILL BE UNNEEDED WHEN @value USED",
                    "type": "object"
                },
                "_tmp": {
                    "description": "TEMPORARY: Schema for a '_tmp' field. THIS FIELD SHOULD NOT BE THERE!",
                    "type": "object"
                }                
            },
            "required": [ "@type", "_value" ]
        },
        "templateFieldPropertiesTypeFieldSchema": {
            "description": "TODO: Schema for the contents of a '@type' field in a 'properties' field in a template field",
            "type": "object"
        },
        "templateFieldPropertiesIDFieldSchema": {
            "description": "Schema for the contents of a '@id' field in a 'properties' field in a template field",
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "string" ] },
                "format": { "type": "string", "enum": [ "uri" ] }
            },
            "required": [ "type", "format" ]            
        },
        "templateField": {
            "allOf": [
                { "$ref": "#/definitions/coreJSONSchemaTemplateFieldFields" },
                { "$ref": "#/definitions/templateFieldJSONLDContextField" },
                { "$ref": "#/definitions/templateFieldJSONLDTypeField" },
                { "$ref": "#/definitions/jsonLDIDField" },
                { "$ref": "#/definitions/templateFieldUIField" },
                { "$ref": "#/definitions/valueConstraintsField" },
                { "$ref": "#/definitions/templateFieldPropertiesField" }
            ]
        },
        "templateElement": {
            "allOf": [
                { "$ref": "#/definitions/coreJSONSchemaTemplateElementFields" },
                { "$ref": "#/definitions/templateElementJSONLDContextField" },
                { "$ref": "#/definitions/templateElementJSONLDTypeField" },
                { "$ref": "#/definitions/jsonLDIDField" },
                { "$ref": "#/definitions/templateElementUIField" },
                { "$ref": "#/definitions/templateElementPropertiesField" }
            ]
        },
        "templateFieldOrElement": {
            "oneOf": [
                { "$ref": "#/definitions/templateField" },
                { "$ref": "#/definitions/templateElement" },
                { "$ref": "#/definitions/templateFieldOrElementArray" }
            ]
        },
        "templateFieldOrElementArray": {
            "type": "object",
            "properties": {
                "type": { "type": "string", "enum": [ "array" ] },
                "minItems": { "type": "number" },
                "maxItems": { "type": "number" },
                "items": { "$ref": "#/definitions/templateFieldOrElement" }
            },
            "required": [ "type", "minItems", "items" ]
        },
        "template": {
            "allOf": [
                { "$ref": "#/definitions/coreJSONSchemaTemplateFields" },
                { "$ref": "#/definitions/templateJSONLDContextField" },
                { "$ref": "#/definitions/templateJSONLDTypeField" },
                { "$ref": "#/definitions/jsonLDIDField" },
                { "$ref": "#/definitions/templateUIField" },
                { "$ref": "#/definitions/provenanceFields" },
                { "$ref": "#/definitions/templatePropertiesField" }
            ]
        }
    },
    "oneOf": [
        { "$ref": "#/definitions/template" },
        { "$ref": "#/definitions/templateElement" },
        { "$ref": "#/definitions/templateField" }
    ]
}
